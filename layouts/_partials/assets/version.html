{{/* 
    Copyright Â© 2022 - 2025 The Hinode Team / Mark Dumay. All rights reserved.
    Use of this source code is governed by The MIT License (MIT) that can be found in the LICENSE file.
    Visit gethinode.com/license for more details.
*/}}

{{/* Retrieves the Hinode theme version from the site's go.mod file (when initialized as module.) */}}
{{- define "_partials/inline/mod-version.html" -}}
    {{- $file := "go.mod" -}}
    {{- $regex := printf `github.com/gethinode/hinode(\/v[0-9]+)? v.*(\r\n|\r|\n)` -}}
    {{- $match := findRE $regex (readFile $file) -}}

    {{- $result := "" -}}
    {{- if gt (len $match) 0 -}}
        {{- $result = (index (split (index $match 0) " ") 1) -}}
        {{- $result = strings.TrimPrefix "v" $result -}}
    {{- end -}}

    {{- return $result -}}
{{- end -}}

{{/* 
    Fallback to initialize the Hinode version from an environment variable. This applies to the main
    Hinode repository including the example site (which is published to demo.gethinode.com). The following
    command initializes the HUGO_HINODE_VERSION using the relevant git tag on macOS/Linux:
    HUGO_HINODE_VERSION=$(git describe --tags $(git rev-list --tags --max-count=1)) npm run build:example
*/}}
{{- define "_partials/inline/env-version.html" -}}
    {{ return getenv "HUGO_HINODE_VERSION"  }}
{{- end -}}

{{- $version := partial "inline/mod-version.html" . -}}
{{ if not $version }}
    {{- $version = partial "inline/env-version.html" . | default "unknown-revision" -}}
{{ end }}
{{- print $version -}}
