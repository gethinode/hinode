{{/* Initialize arguments */}}
{{ $args := partial "utilities/InitArgs.html" (dict "bookshop" "testimonials" "args" .)}}
{{ if or $args.err $args.warnmsg }}
    {{ partial (cond $args.err "utilities/LogErr.html" "utilities/LogWarn.html") (dict 
        "partial" "component-library/components/testimonials/testimonials.hugo.html" 
        "warnid"  "warn-invalid-arguments"
        "msg"     "Invalid arguments"
        "details" ($args.errmsg | append $args.warnmsg)
        "file"    page.File
    )}}
{{ end }}

{{/* Initialize global arguments */}}
{{- $style := partial "utilities/GetBackgroundStyle" (dict "background" .background) -}}
{{- $breakpoint := partial "utilities/GetBreakpoint.html" -}}
{{- $padding := partial "utilities/GetPadding.html" -}}

{{/* Main code */}}
{{ if not $args.err }}
{{ end }}

{{- $colGrid := "" -}}
{{ $colGrid = printf "row-cols-%d" $args.cols }}
{{- if eq $args.cols 1 }}
	{{ $colGrid = "row-cols-1" -}}
{{- else if eq $args.cols 2 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-2" $breakpoint.next }}
{{- else if eq $args.cols 3 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-3" $breakpoint.next }}
{{- else if eq $args.cols 4 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-2 row-cols-%s-4" $breakpoint.current $breakpoint.next }}
{{- else if eq $args.cols 5 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-3 row-cols-%s-5" $breakpoint.current $breakpoint.next }}
{{ end -}}

{{ if and $args.carousel (gt (len $args.testimonials) 1) }}
	{{ $id := printf "testimonial-carousel-%s" (md5 (delimit (slice . now) "-")) }}
	<div id="{{ $id }}" class="carousel slide">
		<div class="carousel-indicators">
			{{ range $index, $item := .testimonials }}
				<button type="button" 
					data-bs-target="#{{ $id }}"
					data-bs-slide-to="{{ $index }}"
					{{ if eq $index 0 }}class="active" aria-current="true"{{ end }}
					aria-label="Slide 1">
				</button>
			{{ end }}
		</div>
		<div class="carousel-inner">
			{{ range $index, $item := $args.testimonials }}
				<div class="carousel-item{{ if eq $index 0 }} active{{ end }}">
					{{ $cardStyle := partial "utilities/GetBackgroundStyle" (dict "background" $.card) }}
					{{ $cardStyle = print $cardStyle " testimonial-carousel-item" }}
					
					{{ partial "assets/testimonial.html" (dict 
						"page"          page
						"content"       $item.content
						"icon"          $item.icon
						"logo"          $item.logo
						"contact"       (cond ($item.client | not | not) $item.client.contact "")
						"role"          (cond ($item.client | not | not) $item.client.role "")
						"image"         (cond ($item.client | not | not) $item.client.image "")
						"url"           (cond ($item.client | not | not) $item.client.url "")
						"link"          $item.link
						"show-controls" true
						"padding"       $padding.x
						"class"         $cardStyle
					)}}
				</div>
			{{ end}}
		</div>
		<button class="carousel-control-prev" type="button" data-bs-target="#{{ $id }}" data-bs-slide="prev">
			{{ partial "assets/icon.html" (dict "icon" "fas chevron-left fa-2xl") }}
			<span class="visually-hidden">{{ T "testimonialPrevious" }}</span>
		</button>
		<button class="carousel-control-next" type="button" data-bs-target="#{{ $id }}" data-bs-slide="next">
			{{ partial "assets/icon.html" (dict "icon" "fas chevron-right fa-2xl") }}
			<span class="visually-hidden">{{ T "testimonialNext" }}</span>
		</button>
	</div>
{{ else }}
	<div class="container p-0">
		<div class="row {{ $colGrid }} g-3">
			{{ range .testimonials }}
				<div class="col">
					{{ partial "assets/testimonial.html" (dict 
						"page"        page
						"content"     .content
						"icon"        .icon
						"logo"        .logo
						"contact"     (cond (.client | not | not) .client.contact "")
						"role"        (cond (.client | not | not) .client.role "")
						"image"       (cond (.client | not | not) .client.image "")
						"url"         (cond (.client | not | not) .client.url "")
						"link"        .link
						"padding"     $padding.x
						"class"       (partial "utilities/GetBackgroundStyle" (dict "background" $.card))
					)}}
				</div>
			{{ end}}
		</div>
	</div>
{{ end }}