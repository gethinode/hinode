{{/* 
    Copyright Â© 2025 - 2026 The Hinode Team / Mark Dumay. All rights reserved.
    Use of this source code is governed by The MIT License (MIT) that can be found in the LICENSE file.
    Visit gethinode.com/license for more details.

	Note: To support live editing, bookshop components should use a clear path to the provided arguments.
	Therefore, we cannot use the InitArgs partial at this point, and we need to access each argument
	directly. See the docs for more background:
	https://github.com/CloudCannon/bookshop/blob/main/guides/hugo.adoc#passing-data-to-bookshop-components
*/}}

{{ define "_partials/inline/testimonial-carousel.html" }}
	{{ $carousel := .carousel }}	
	{{ $testimonials := .testimonials }}
	{{ $card := .card }}
	{{ $padding := .padding }}
	{{ $colGrid := .colGrid }}
	{{ $iconStyle := index . "icon-style" }}

	{{ if and $carousel (gt (len $testimonials) 1) }}
		{{ $id := printf "testimonial-carousel-%s" (md5 (delimit (slice . now) "-")) }}
		<div id="{{ $id }}" class="carousel slide">
			<div class="carousel-indicators">
				{{ range $index, $item := $testimonials }}
					<button type="button" 
						data-bs-target="#{{ $id }}"
						data-bs-slide-to="{{ $index }}"
						{{ if eq $index 0 }}class="active" aria-current="true"{{ end }}
						aria-label="Slide 1">
					</button>
				{{ end }}
			</div>
			<div class="carousel-inner">
				{{ range $index, $item := $testimonials }}
					<div class="carousel-item{{ if eq $index 0 }} active{{ end }}">
						{{ $cardStyle := partial "utilities/GetBackgroundStyle" (dict "background" $card) }}
						{{ $cardStyle = print $cardStyle " testimonial-carousel-item" }}
						
						{{ partial "assets/testimonial.html" (dict 
							"page"          page
							"content"       $item.content
							"icon"          $item.icon
							"logo"          $item.logo
							"contact"       (cond ($item.client | not | not) $item.client.contact "")
							"role"          (cond ($item.client | not | not) $item.client.role "")
							"image"         (cond ($item.client | not | not) $item.client.image "")
							"url"           (cond ($item.client | not | not) $item.client.url "")
							"link"          $item.link
							"show-controls" true
							"padding"       $padding.x
							"class"         $cardStyle
						)}}
					</div>
				{{ end}}
			</div>
			<button class="carousel-control-prev" type="button" data-bs-target="#{{ $id }}" data-bs-slide="prev">
				{{ partial "assets/icon.html" (dict "icon" "fas chevron-left fa-2xl") }}
				<span class="visually-hidden">{{ T "testimonialPrevious" }}</span>
			</button>
			<button class="carousel-control-next" type="button" data-bs-target="#{{ $id }}" data-bs-slide="next">
				{{ partial "assets/icon.html" (dict "icon" "fas chevron-right fa-2xl") }}
				<span class="visually-hidden">{{ T "testimonialNext" }}</span>
			</button>
		</div>
	{{ else }}
		<div class="testimonial-grid container p-0">
			<div class="row {{ $colGrid }} g-3">
				{{ range $testimonials }}
					<div class="col">
						{{ partial "assets/testimonial.html" (dict 
							"page"        page
							"content"     .content
							"icon"        .icon
							"icon-style"  $iconStyle
							"logo"        .logo
							"contact"     (cond (.client | not | not) .client.contact "")
							"role"        (cond (.client | not | not) .client.role "")
							"image"       (cond (.client | not | not) .client.image "")
							"url"         (cond (.client | not | not) .client.url "")
							"link"        .link
							"padding"     $padding.x
							"class"       (partial "utilities/GetBackgroundStyle" (dict "background" $card))
						)}}
					</div>
				{{ end}}
			</div>
		</div>
	{{ end }}
{{ end }}

{{/* Initialize global arguments */}}
{{- $style := partial "utilities/GetBackgroundStyle" (dict "background" .background) -}}
{{- $breakpoint := partial "utilities/GetBreakpoint.html" -}}
{{- $padding := partial "utilities/GetPadding.html" -}}

{{/* Main code */}}
{{ $colGrid := printf "row-cols-%d" (.cols | default 1) }}
{{- if eq .cols 1 }}
	{{ $colGrid = "row-cols-1" -}}
{{- else if eq .cols 2 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-2" $breakpoint.next }}
{{- else if eq .cols 3 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-3" $breakpoint.next }}
{{- else if eq .cols 4 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-2 row-cols-%s-4" $breakpoint.current $breakpoint.next }}
{{- else if eq .cols 5 }}
	{{ $colGrid = printf "row-cols-1 row-cols-%s-3 row-cols-%s-5" $breakpoint.current $breakpoint.next }}
{{ end -}}

{{ $raw := partial "inline/testimonial-carousel.html" (dict 
	"carousel"     .carousel
	"testimonials" .testimonials
	"card"         .card
	"padding"      .padding
	"colGrid"      .colGrid
	"icon-style"   (or .icon_style (index . "icon-style"))
) }}

{{ if $raw }}
	{{ partial "utilities/section.html" (dict 
		"component-name" "testimonials"
		"id"             .id
		"raw"            $raw
		"background"     .background
		"width"          .width
		"justify"        .justify
		"wrapper"        .wrapper
		"fluid"          .fluid
		"theme"          .theme
		"cover"          .cover
		"overlay-mode"   (or .overlay_mode (index . "overlay-mode"))
		"section-class"  (or .section_class (index . "section-class"))
		"bg-class"       (or .bg_class (index . "bg-class"))
	)}}
{{ end }}