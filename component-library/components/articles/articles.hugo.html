{{/* 
    Copyright Â© 2025 - 2026 The Hinode Team / Mark Dumay. All rights reserved.
    Use of this source code is governed by The MIT License (MIT) that can be found in the LICENSE file.
    Visit gethinode.com/license for more details.

	Note: To support live editing, bookshop components should use a clear path to the provided arguments.
	Therefore, we cannot use the InitArgs partial at this point, and we need to access each argument
	directly. See the docs for more background:
	https://github.com/CloudCannon/bookshop/blob/main/guides/hugo.adoc#passing-data-to-bookshop-components
*/}}

{{/* Initialize global arguments */}}
{{- $padding := partial "utilities/GetPadding.html" -}}

{{/* Initialize local variables */}}
{{ $raw := "" }}
{{ $pages := slice }}
{{ $section := "" }}
{{ $categories := "" }}
{{ $result := dict "total" 0 }}
{{ with .input }}
	{{ $section = .section }}
	{{ $categories = .categories }}
	{{ $result = partial "assets/live-pages.html" (dict 
		"page"       $.page
		"section"    .section
		"nested"     .nested
		"keywords"   .keywords
		"categories" .categories
		"tags"       .tags
		"sort"       .sort
		"reverse"    .reverse
	)}}
	{{ $pages = $result.pages }}
{{ end }}

<!-- Add style definitions -->
{{ $styles := slice 
	(dict "ratio" "1x1"  "orientation" "overlay" "portrait" false "width" "6")
	(dict "ratio" "4x3"  "orientation" "stacked" "portrait" true  "width" "3")
	(dict "ratio" "1x1"  "orientation" "stacked" "portrait" false "width" "3")
	(dict "ratio" "16x9" "orientation" "stacked" "portrait" true  "width" "3")
	(dict "ratio" "1x1"  "orientation" "stacked" "portrait" false "width" "3")
}}

{{ if gt (len (or .styles slice)) 0 }}
	{{ $styles = .styles }}
{{ end }}

<!-- Define more button -->
{{ $moreButton := site.Params.modules.bookshop.articles.moreButton | default false }}
{{ $title := or $section $categories (T "article") }}
{{ $moreLink := $section }}
{{ $moreTitle := T "more" (pluralize $title) }}
{{ $moreType := "button" }}
{{ $moreIcon := "" }}
{{ with .more }}
	{{ if .title }}{{ $moreTitle = .title }}{{ end }}
	{{ if .link }}{{ $moreLink = .link }}{{ end }}
	{{ if or (.link_type) (index . "link-type") }}{{ $moreType = (.link_type) (index . "link-type") }}{{ end }}
	{{ if .icon }}{{ $moreIcon = .icon }}{{ end }}
{{ end }}

{{ $paginate := .paginate }}
{{ if and $paginate page.IsPage }}
    {{ partial "utilities/LogWarn.html" (dict 
        "partial" "component-library/components/articles/articles.hugo.html"
        "msg"     "Pagination not supported"
        "file"    page.File
    )}}
	{{ $paginate = false }}
{{ end }}

{{/* Main code */}}
{{ if or (gt (len $pages) 0) (not .hide_empty) }}
	{{- $raw = printf "%s%s" $raw (partial "assets/section-title.html" (dict
		"heading" .heading
		"justify" .justify
		"class"   (printf "pb-%d" $padding.y)))
	-}}

	{{ $partial := "assets/card-group.html" }}
	{{ $params := dict }}
	{{- $params = merge $params (dict
		"page"           page
		"list"           $pages
		"cols"           .cols
		"limit"          .limit
		"padding"        .padding
		"href"           (cond $moreButton $moreLink "")
		"href-force"     (gt $result.total (len $result.pages))
	)}}

	{{ if .scroll }}
		{{ $partial = "assets/stack.html" }}
		{{ $params = merge $params (dict 
			"header-style" "none"
			"body-style"   "title"
			"footer-style" "none"
			"gutter"       1
			"ratio"        "1x1"
			"orientation"  "horizontal-sm"
			"animated"     .animated
			"styles"       (cond .bento $styles "")
		) -}}
	{{ else }}
		{{ $params = merge $params (dict 
			"header-style"   (or .header_style (index . "header-style"))
			"body-style"     (or .body_style (index . "body-style"))
			"footer-style"   (or .footer_style (index . "footer-style"))
			"class"          (or .class "border-0")
			"align"          "start"
			"orientation"    .orientation
			"href-title"     (cond $moreButton $moreTitle "")
			"icon-rounded"   .icon_rounded
			"icon-style"     .icon_style
			"hook"           "assets/live-card.html"
			"more-link-type" $moreType
			"more-link-icon" $moreIcon
			"pagination"     .pagination
			"paginate"       $paginate
		) -}}
	{{ end }}
	{{ if gt (len $pages) 0 }}
		{{ $raw = printf "%s%s" $raw (partial $partial $params) }}
	{{ else }}
		{{ $raw = printf "%s%s" $raw (printf `<p class="pt-%d">%s.</p>` $padding.y (T "emptyList")) }}
	{{ end }}

	{{ if $raw }}
		{{ partial "utilities/section.html" (dict 
			"component-name" "articles"
			"id"             .id
			"raw"            $raw
			"background"     .background
			"width"          .width
			"justify"        .justify
			"wrapper"        .wrapper
			"fluid"          .fluid
			"theme"          .theme
			"cover"          .cover
			"overlay-mode"   (or .overlay_mode (index . "overlay-mode"))
			"section-class"  (or .section_class (index . "section-class"))
			"bg-class"       (or .bg_class (index . "bg-class"))
		)}}
	{{ end }}
{{ end }}
